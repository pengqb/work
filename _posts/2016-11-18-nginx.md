# 负载均衡器分类 #
无论硬件或软件实现，都逃不出基于四层交互技术的“报文转发”或基于七层协议的“请求代理”这两种方式。四层的转发模式通常性能会更好，但七层的代理模式可以根据更多的信息做到更智能地分发流量。一般大规模应用中，这两种方式会同时存在。

F5的硬件负载均衡产品又分单机和集群系列。12250v是单机中的高端版本，能支撑每秒150万新建连接数，8000万并发连接数，84G数据吞吐量。集群系列中VIPRION 4800阵列是旗舰产品，每个阵列支持最多8个Blade，每个Blade提供每秒290万新建连接数，1.8亿并发连接数以及140G数据吞吐量。按线性比例计算，一个顶配的VIPRION 4800阵列能满足绝大多数海量互联网应用的业务需求了。

LVS作为目前互联网时代最知名的负载均衡软件，在性能与成本方面结合地很好，阿里云的SLB产品也通过LVS实现，因此也继承了LVS的优点和缺点。LVS最常用的有NAT、DR以及新的FULL NAT模式。
我们认为LVS的每种模式都有较大的缺点，但这并不是最为致命的。最为致命的是LVS本质上是一个工作于Linux内核层的负载均衡器，它的上限取决于Linux内核的网络性能，但Linux内核的网络路径过长导致了大量开销，使得LVS单机性能较低。
Google于2016年3月最新公布的负载均衡Maglev实现完全绕过了Linux内核(Kernel Bypass)，也就是说Google已经采用了与LVS不同的技术思路。 

# nginx支持多少并发，多少吞吐率（throughput）#
Nginx的高并发，官方测试支持5万并发连接。实际生产环境能到2-3万并发连接数。淘宝tengine团队测试结果是“24G内存机器上，处理并发请求可达200万”。
Nginx 服务器可以稳定地达到 904,000 次/秒 的处理性能，并且我以此高负载测试超过 12 小时，服务器工作稳定。Transfer/sec:  0.98GB

为最佳性能调优 Nginx
http://blog.jobbole.com/87531/

NGINX引入线程池 性能提升9倍
http://www.infoq.com/cn/articles/thread-pools-boost-performance-9x

# 负载均衡器产品 #
Google Maglev：基于商用服务器的负载均衡器（GoogleMaglev.pdf）安装后不需要预热5秒内就能应付每秒100万次请求。

http://www.infoq.com/cn/news/2016/03/google-maglev?utm_source=news_about_load_balancing&utm_medium=link&utm_campaign=load_balancing

从Maglev到Vortex，揭秘100G＋线速负载均衡的设计与实现
http://www.infoq.com/cn/articles/Maglev-Vortex

# 系统需求 #
到2020年全球将有200亿—2000亿物联网设备（Gartner 预测260亿，ABI预测300亿，Oracle 预测500亿，Intel 预测2000亿）
系统200亿设备，30亿用户，分布在全球6个数据中心，中国、北美、欧洲、亚太、南美、非洲。大约每个中心40亿设备，6亿用户。
getServerInfo，注册、登录、激活在同一个nginx下。设备每天调用一次，用户每天调用一次。虽然登录是7天调用1次，但token续期算每天调用一次。相当于rps=266204（（200亿+30亿）/24/3600）。由于getServerInfo是单点，nginx目前最多支持100Wrps，所以getServerInfo最多可以支持到800亿设备，120亿用户，这也是系统的最大容量。
publishBatch，每10分钟上报一次publishBatch，40亿设备相当于rps=6666667。这需要7个nginx节点。假设一个请求500Byte，则带宽：3.1GBps，需要100gbps网络
deviceUpdate，同publishBatch。
