# Installation #
安装位置 vanelife-mysql，192.168.0.4 /usr/local/redis-3.2.6

Download, extract and compile Redis with:
$ wget http://download.redis.io/releases/redis-3.2.6.tar.gz
$ tar xzf redis-3.2.6.tar.gz
$ cd redis-3.2.6
$ make

The binaries that are now compiled are available in the src directory. Run Redis with:

    $ src/redis-server ./redis.conf

You can interact with Redis using the built-in client:

    $ src/redis-cli
    redis> set foo bar
    OK
    redis> get foo
    "bar"

# 配置 #
开启保护模式
protected-mode yes

指定绑定的客户端
bind 192.168.1.100 192.168.1.99 127.0.0.1

指定访问密码
requirepass vane123

# redis性能 #
本机redis访问throughput<30000rps
局域网redis访问throughput<14000rps
这和redis本身benchmark测试40000rps左右的吞吐量相吻合

使用异步日志后，不访问redis，应用服务器和wrk在同一个局域网跨局域网访问：
[root@vanelife-mysql wrk]# ./wrk -t8 -c64 -d30s -T10s --latency http://192.168.0.9:8080/rest/hello

    Running 30s test @ http://192.168.0.9:8080/rest/hello
      8 threads and 64 connections
      Thread Stats   Avg  Stdev Max   +/- Stdev
    	Latency 1.89ms2.05ms  69.00ms   96.62%
    	Req/Sec 4.57k   426.7511.63k77.55%
      Latency Distribution
     	50%1.64ms
    	75%1.97ms
     	90%2.63ms
     	99%6.34ms
      1091918 requests in 30.10s, 104.13MB read
    Requests/sec:  36275.92
    Transfer/sec:  3.46MB

使用异步日志后，不访问redis，应用服务器和wrk在本地访问：
[root@vane-turn01 wrk]# ./wrk -t8 -c64 -d30s -T10s --latency http://192.168.0.9:8080/rest/hello

    Running 30s test @ http://192.168.0.9:8080/rest/hello
      8 threads and 64 connections
      Thread Stats   Avg  Stdev Max   +/- Stdev
    	Latency   848.59us2.52ms  95.95ms   97.11%
    	Req/Sec13.62k 1.67k   20.39k75.62%
      Latency Distribution
     	50%  417.00us
     	75%0.87ms
     	90%1.60ms
     	99%6.48ms
      3258688 requests in 30.09s, 310.77MB read
    Requests/sec: 108312.11
    Transfer/sec: 10.33MB

增加redis访问后的性能
应用服务器和redis在同一个局域网
[root@vanelife-mysql wrk]# ./wrk -t8 -c64 -d30s -T10s --latency http://192.168.0.9:8080/rest/hello

    Running 30s test @ http://192.168.0.9:8080/rest/hello
      8 threads and 64 connections
      Thread Stats   Avg  Stdev Max   +/- Stdev
    	Latency 4.84ms3.35ms  80.95ms   91.64%
    	Req/Sec 1.74k   276.69 2.56k70.25%
      Latency Distribution
     	50%4.14ms
     	75%5.93ms
     	90%7.67ms
     	99%   14.14ms
      414827 requests in 30.03s, 59.34MB read
    Requests/sec:  13814.11
    Transfer/sec:  1.98MB

应用服务器和redis在同一台服务器
[root@vanelife-mysql wrk]# ./wrk -t8 -c64 -d30s -T10s --latency http://192.168.0.4:8080/rest/hello

	Running 30s test @ http://192.168.0.4:8080/rest/hello
	  8 threads and 64 connections
	  Thread Stats   Avg      Stdev     Max   +/- Stdev
	    Latency     2.40ms    2.04ms  38.44ms   87.91%
	    Req/Sec     3.72k   628.99     6.01k    67.71%
	  Latency Distribution
	     50%    1.89ms
	     75%    3.04ms
	     90%    4.65ms
	     99%    9.52ms
	  889306 requests in 30.05s, 127.22MB read
	Requests/sec:  29594.43
	Transfer/sec:      4.23MB

通过异步LettuceClient，应用服务器和redis在同一局域网，throughput能达到86790。

    curl -H "Content-type: application/json" -X POST -d '{"devSn":"add","devKey":"abc"}' http://192.168.18.138:8080/auth/gw/active
    ./wrk -t8 -c64 -d30s -T10s --latency http://192.168.0.9:8080/rest/hello
    nohup java -Xms4096m -Xmx4096m -Djava.rmi.server.hostname=192.168.0.9 -Dcom.sun.management.jmxremote.port=1090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector -jar auth.jar 00100000 >/dev/null &
    nohup java -Xms4096m -Xmx4096m -Djava.rmi.server.hostname=192.168.0.4 -Dcom.sun.management.jmxremote.port=1090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector -jar auth.jar 00000000 >/dev/null &

[root@vane-turn01 wrk]# ./wrk -t8 -c64 -d30s -T10s --latency     http://192.168.0.9:8080/rest/hello
    Running 30s test @ http://192.168.0.9:8080/rest/hello
      8 threads and 64 connections
      Thread Stats   Avg  Stdev Max   +/- Stdev
    	Latency14.08ms   65.84ms 646.18ms   95.50%
    	Req/Sec11.45k 2.45k   23.44k81.34%
      Latency Distribution
     	50%  496.00us
     	75%1.24ms
     	90%4.16ms
     	99%  408.07ms
      2612118 requests in 30.10s, 373.67MB read
    Requests/sec:  86790.05
    Transfer/sec: 12.42MB