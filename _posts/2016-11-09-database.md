# 什么是时序数据库 #
最简单的定义就是数据格式里包含timestamp字段的数据。主要来源是来自于各种“传感器”所产生的时序数据记录,例如物联网。


# 时序数据库特点 #
- 追加为主,不需要快速更新,甚至不需要更新
- 对事务要求较低，丢一两条数据影响不大
- 支持数据超期自动淘汰

# 传统数据库痛点 #
- 关系数据库： 具备复杂检索能力，但受限于数据存储规模和录入、查询速度不足
- NOSQL 数据库 ：具备可扩展性和高性能，但受限于检索和分析能力不足
- HADOOP  ：具备数据分析能力和可扩展性，但受限于数据处理实时性不足

# 传统数据库折中办法 #
- 只保存近期数据(无奈的丢弃老数据)。
- 只存储一些抽样记录(如: 降频down-sampling到只记录整点数据)。
- 批量入库(如，每10秒钟积攒一批数据再批量入库)。
- 延迟入库(批量入库本身就是延迟的，这会影响用户查询设备状态时的体验)。


# 优点 #
- 借助LSM树维护有序记录，磁盘顺序读写，效率高
- 高压缩比，节约存储空间
- 支持数据超期自动淘汰

# 原理 #

传统数据库在时序数据无序写入的情形下，会造成数据在物理存储上也无序分布。所以即便在时间列上建有索引，按时间断面查询还是无法顺序扫描磁盘，而需要不断seek才能定位数据 —— 我们知道在磁盘上只有顺序读写性能才是最佳，随机读写性能要相差百倍以上。

节约存储空间：无需额外索引文件，节约了大量存储空间；支持行和列的压缩，有3-4倍的压缩比。

# 使用场景 #
区间内个体回放：时间区间上进行精确、模糊、条件检索。使用KT存储格式。
区间内统计分析：时间区间上进行各种统计分析计算。使用TK存储格式。
侦查员追查嫌疑车辆轨迹，或疑犯的通话记录等场景，属标准的个体回放需求，应优先考虑KT格式；路况车流等指标计算则属于区间内统计分析运算需求，应优先考虑TK格式；但当你既想查看给定车轨迹，又想统计路况信息时，则可以选择PKT格式了。或者一份数据存储2个副本，一份是KT格式，一份是TK格式。
列式存储格式的副本应对分析类任务，行存储格式应对检索任务。
TK 格式(即 TIMESTAMP-KEY 格式) —— 该格式首先按照事件发生时间排序，当时间相同时，则再按照事件ID(key)排序。具体 Layout 如下:

Timestamp       Key  Colume1  Colume2 ...

1340109000000   K1

1340109600000   K1

1340109600000   K3

KT 格式(即 KEY-TIMESTAMP 格式) —— 该格式首先按照key排序。当在key相同时，则再按照事件发生时间再排序。具体 Layout 如下:

Key    Timestamp  Colume1  Colume2 ...

K1     1340109000000

K1     1340112900000

K2     1340109000000

PKT 格式(即 PARTITION-KEY-TIMESTAMP 格式) —— 该格式首先按照时间分区分组排序(其中partition可选择小时、天、月、年等时间单位，其类似传统数据库中的分区概念)，在组内首先按照KEY排序，相同KEY再按照事件时间排序。具体 Layout如下: 
分区单位-小时

Parttion  Key  Timestamp  Colume1  Colume2  ...

13401072  K1   1340109000000

13401072  K3   1340109600000

13401108  K1   1340112900000

传统数据库由于设计初衷是应对“档案”数据，而非时序数据。

# 问题 #
- 1.写入速度如何？
采用LevelDB索引（LSM树），LSM树牺牲了部分读性能，用来大幅提高写性能。基于LSM树实现的HBase的写性能比Mysql高了一个数量级，读性能低了一个数量级。时序数据库中读不是问题。
- 2.TK格式和KT格式具体是怎么存储的，才能保证顺序读。
借助LSM树维护有序记录,对于每个K,按时间分片存储。
- 3.如何删除数据？

# 参考文献 #
http://www.infoq.com/cn/articles/database-timestamp-01

http://www.infoq.com/cn/articles/database-timestamp-02

http://www.infoq.com/cn/articles/database-timestamp-03

http://www.cnblogs.com/yanghuahui/p/3483754.html