# 一、安装 #
## 1、安装第三方epel源 ##
centos 5的epel

    rpm -ivh http://mirrors.sohu.com/fedora-epel/5/x86_64/epel-release-5-4.noarch.rpm

centos 6的epel

	rpm -ivh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm

查看系统版本

    17:01:30 # cat /etc/issue
    CentOS release 6.5 (Final)
    Kernel \r on an \m

由于是6版本所以安装6的epel

## 2、安装ansible ##
    yum install ansible

如果需要自定义module或者想阅读源码、使用最新版本，可以去github里下载源码
	git clone https://github.com/ansible/ansible.git

## 3、客户端安装libselinux-python ##
如果用到copy/file/template模块，则需要在客户端安装

	yum install -y libselinux-python

# 二、连接客户端 #
## 1、添加客户端 ##
    17:22:08 # cd /etc/ansible/
    root@ip-10-10-10-10:/etc/ansible
    17:23:27 # ll
    total 12
    -rw-r--r-- 1 root root 5113 Dec 29 03:00 ansible.cfg
    -rw-r--r-- 1 root root  965 Dec 29 03:00 hosts
    其中ansible.cfg是配置文件，hosts是管理主机信息
    17:24:44 # cat hosts
    [app]
    192.168.0.7
    192.168.0.6
    192.168.0.8
    192.168.0.11    
    [mq]
    192.168.0.13
## 2、SSH免密钥登录设置 ##
在Ansible服务器上生成公钥/私钥并拷贝到客户端上

    [root@vanelife-nginx2 ansible]# ssh-keygen -t rsa -P ''
    Generating public/private rsa key pair.
    Enter file in which to save the key (/root/.ssh/id_rsa): /root/.ssh/id_rsa_storm1
    Your identification has been saved in /root/.ssh/id_rsa_storm1.
    Your public key has been saved in /root/.ssh/id_rsa_storm1.pub.
	......
	[root@vanelife-nginx2 .ssh]# scp /root/.ssh/id_rsa_storm1.pub root@192.168.0.7:/root/.ssh/
    [root@vanelife-nginx2 .ssh]# scp /root/.ssh/id_rsa_storm1.pub root@192.168.0.6:/root/.ssh/
    [root@vanelife-nginx2 .ssh]# scp /root/.ssh/id_rsa_storm1.pub root@192.168.0.8:/root/.ssh/
    [root@vanelife-nginx2 .ssh]# scp /root/.ssh/id_rsa_storm1.pub root@192.168.0.11:/root/.ssh/
    [root@vanelife-nginx2 .ssh]# scp /root/.ssh/id_rsa_storm1.pub root@192.168.0.13:/root/.ssh/

在客户端上

    cat /root/.ssh/id_rsa_storm1.pub >> /root/.ssh/authorized_keys
    chmod 600 /root/.ssh/authorized_keys

在ansible服务器上配置

    # vim /etc/ansible/ansible.cfg
    ......
    private_key_file = /root/.ssh/id_rsa_storm1
    ......

# 三、使用Ansible #
Ansible 模块命令

	ansible 操作目标 -m 模块名 -a 模块参数

ping模块：主要是无意义的测试模块
    ansible all -m ping

远程主机运行命令
	[root@vanelife-nginx2 ansible]# ansible mq -m command -a 'uptime'
    192.168.0.13 | SUCCESS | rc=0 >>
    23:05:39 up 84 days, 13:17,  2 users,  load average: 1.08, 1.02, 1.01

setup用来查看远程主机的一些基本信息

	# ansible app -m setup

执行Ansible服务器端命令，可以使用通配符

	[root@vanelife-nginx2 ~]# ansible 192* -m ping

copy模块：控制端向目标主机拷贝文件，类似scp

    ansible mq -m copy -a "src=/home/tomcat/config.properties dest=/app/tomcat/config.properties backup=yes owner=root group=root mode=0644"
	ansible mq -m shell -a "ls -l /app/tomcat/"

还有另外一个模块file，可以修改用户与权限

    ansible mq -m file -a "dest=/app/tomcat/config.properties mode=0755"

安装软件

    ansible mq -m raw -a "yum -y install iperf"